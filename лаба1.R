# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç 1: AR(p) - –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø–æ—Ä—è–¥–∫–∞ p

# 1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ ùê¥ùëÖ(1), –∏–∑ ùëõ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π, –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
# –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùúÉ: a) |ùúÉ| < 1, b) |ùúÉ| = 1, c) |ùúÉ| > 1.
n = 500 # –æ–±—ä–µ–º –≤—ã–±–æ—Ä–∫–∏
ar = function(n, theta) # —Ñ-—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π AR(1)
{
  x = numeric(n) # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω—É–ª—è–º–∏
  x[1] = rnorm(1,0,1) # –°–ª—É—á–∞–π–Ω–æ–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ  
 
  for (k in 2:n) {
    eps = rnorm(1,0,1) # –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π ùúÄ(k) —Å –º–∞—Ç –æ–∂–∏–¥–∞–Ω–∏–µ–º 0 –∏ –¥–∏—Å–ø–µ—Ä—Å–∏–µ–π 1
    x[k] = theta * x[k - 1] + eps # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ AR(1)
  }
  return(x)
}

n1 = ar(n, 0.5); n1
plot(n1, type = 'l') # –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1) 
n2 = ar(n, 1); n2
plot(n2, type = 'l')
n3 = ar(n, 2); n3
plot(n3, type = 'l')

# 2. –û—Ü–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä |ùúÉ| ‚â§ 1 –ø–æ –º–µ—Ç–æ–¥—É –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ (–ú–ù–ö).
# 3. –ù–∞–π—Ç–∏ –æ—Ü–µ–Ω–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è (–ú–ü) –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùúÉ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1). 
# –°–¥–µ–ª–∞–π—Ç–µ –≤—ã–≤–æ–¥ –æ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏ –æ—Ü–µ–Ω–æ–∫ –ú–ù–ö –∏ –ú–ü –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùúÉ –≤ —Å–ª—É—á–∞–µ –≥–∞—É—Å—Å–æ–≤—Å–∫–æ–≥–æ —à—É–º–∞.

theta_values = c(0.5, 1) # –≤–µ–∫—Ç–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π —Ç–µ—Ç–∞

for (theta in theta_values) {
  x = ar(n, theta) # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ AR(1)
  a = b = 0
  # –û—Ü–µ–Ω–∫–∞ –ú–ù–ö
  for (i in 2:n) {
    a = a + x[i] * x[i - 1] # Œ£(x_i * x_(i-1))
    b = b + x[i-1]^2 # Œ£(x_(i-1)^2)
  }
  MNK = if (b != 0) a/b else 0
  
  # –û—Ü–µ–Ω–∫–∞ –ú–ü
  MP = function(theta) {
    eps = numeric(n)
    for (k in 2:n) {
      eps[k] = (x[k] - theta * x[k - 1])^2
    }
    return(sum(eps)) # –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–æ–≤
  }
  xmin = optimize(f = MP, c(-2, 2))$minimum
  # –í—ã–≤–æ–¥ –æ—Ü–µ–Ω–æ–∫
  print(paste("Œ∏:", theta, "–ú–ù–ö:", MNK, "–ú–ü:", xmin))
}
# –°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ—Ü–µ–Ω–∫–∏ –ø–æ –º–µ—Ç–æ–¥—É –ú–ù–ö –∏ –ø–æ –º–µ—Ç–æ–¥—É –ú–ü –æ–¥–∏–Ω–∞–∫–æ–≤—ã.

# 4. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ú–ù–ö-–æ—Ü–µ–Ω–∫–∏ –¥–ª—è –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏ ùëò= 10, 11,...,ùëõ. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ 
# –¥–∏–Ω–∞–º–∏–∫—É –æ—Ü–µ–Ω–∫–∏, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏, –∏ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã.
theta = 0.5
n1 = 1000 # –æ–±—ä–µ–º –≤—ã–±–æ—Ä–∫–∏
x1 = ar(n, theta)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ú–ù–ö-–æ—Ü–µ–Ω–æ–∫
estimates = numeric(n1 - 9)  # –î–ª—è k = 10 –¥–æ n
# –†–∞—Å—á–µ—Ç –ú–ù–ö-–æ—Ü–µ–Ω–æ–∫
for (k in 10:n1) {
  x = x1[1:(k - 1)]
  y = x1[2:k]
  # –ú–ù–ö-–æ—Ü–µ–Ω–∫–∞
  estimates[k - 9] = sum(x * y) / sum(x^2)
}
# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
plot(10:n1, estimates, type = "o", col = "blue", 
     xlab = "–û–±—ä–µ–º –≤—ã–±–æ—Ä–∫–∏ (k)", ylab = "–ú–ù–ö-–æ—Ü–µ–Ω–∫–∞", 
     main = "–î–∏–Ω–∞–º–∏–∫–∞ –ú–ù–ö-–æ—Ü–µ–Ω–æ–∫ –¥–ª—è AR(1) –ø—Ä–æ—Ü–µ—Å—Å–∞")

# 5. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(2) –∏–∑ n –Ω–∞–±–ª—é–¥–µ–Ω–∏–π.
n = 1000
theta1 = 0.5
theta2 = 0.25

ar2 = function(n, theta1, theta2) # —Ñ-—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏–π AR(2)
  {
  x = numeric(n)
  x[1] = rnorm(1)  # –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  x[2] = rnorm(1)  # –í—Ç–æ—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  
  for (k in 3:n) {
    eps = rnorm(1) # –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π ùúÄ(k)
    x[k] = theta1 * x[k - 1] + theta2 * x[k - 2] + eps # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ AR(2)
  }
  return(x)
}

a2 = ar2(n, theta1, theta2) # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è AR(2) –ø—Ä–æ—Ü–µ—Å—Å–∞
# –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
plot(a2, type = "l", col = "blue",
     xlab = "–ù–∞–±–ª—é–¥–µ–Ω–∏—è", ylab = "–ó–Ω–∞—á–µ–Ω–∏–µ",
     main = "–ì—Ä–∞—Ñ–∏–∫ —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(2)")

# 6. –í—ã—á–∏—Å–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ AR(2), –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é arima –ø–∞–∫–µ—Ç–∞ stats.
library("stats")
arima(a2, order = c(2, 0, 0), include.mean = FALSE)
