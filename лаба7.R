# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 7: –ú–æ–¥–µ–ª—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è —Å—Ç—Ä–∞—Ö–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏.

# 1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 1000 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω Nt –ø—Ä–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ t = 50, ùúÜ= 2.
# 2. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–ª–æ–∂–∏—Ç—å –Ω–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É –≥—Ä–∞—Ñ–∏–∫ (13).
t = 50
Œª = 2
n = 1000
N = 0
for(i in 1 : 1000) 
{
  œÑ = k = 0
  while(sum(œÑ) < 50) # –ø–æ–¥—Å—á–µ—Ç –º–æ–º–µ–Ω—Ç–æ–≤ {ùëáùëõ} –≤ –ø—Ä–æ–º–µ–∂—É—Ç–∫–µ [0,t]
  {
    œÑ[k + 1] = rexp(1, Œª) # –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É —Å—Ç—Ä–∞—Ö–æ–≤—ã–º–∏ —Å–ª—É—á–∞—è–º–∏ –∏–º–µ—é—Ç 
    # —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º Œª
    k = k + 1
  }
  N[i] = k
}

hist(N, freq = FALSE, main = "–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥-—Ç–∏ –∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ (13):")
P = 0
f = function(k)
{
  P = (Œª*t)^k/factorial(k)*exp(-Œª*t)
  return(P)
}

curve(f(x), add = TRUE) # –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ü—É–∞—Å—Å–æ–Ω–∞

# 3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (12) –¥–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ tmax –∏
# –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –≥—Ä–∞—Ñ–∏–∫. –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —Å—Ç—Ä–∞—Ö–æ–≤—ã–µ –≤—ã–ø–ª–∞—Ç—ã ùëãùëñ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã 
# –ø–æ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –∑–∞–∫–æ–Ω—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º —Ä–∞–≤–Ω—ã–º 1/ùúá.

t_max = 50
U_0 = 50
U1 = U2 = 0
œÑ1 = œÑ2 = 0

# –∞) –£—Å–ª–æ–≤–∏–µ: ùúå = (ùëê/ùúÜùúá) ‚àí 1 > 0 –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö:
c1 = 2
Œª1 = 0.3
Œº1 = 3
œÅ1 = c1/(Œª1*Œº1) - 1; œÅ1 # > 0

i = 2
U1[1] = U_0
T1 = 0
œÑ1[1] = rexp(1, Œª1)
T1[1] = œÑ2[1]
while (T1[i - 1] < t_max)
{
  œÑ1[i] = rexp(1, Œª1)
  T1[i] = T1[i - 1] + œÑ1[i] # —Ä–µ–∞–ª–∏–∑—É–µ–º —Å.–≤. ùúèi, –∫–æ—Ç–æ—Ä–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–µ–ª–∏—á–∏–Ω–∞ ùëái = ùúèi 
  # –∏ –≤ –º–æ–º–µ–Ω—Ç ùëái —Ä–µ–∞–ª–∏–∑—É–µ–º —Å.–≤. ùëãi –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–µ–ª–∏—á–∏–Ω—É ùëàùëái
  
  X = rexp(1, 1/Œº1) # —Å—Ç—Ä–∞—Ö–æ–≤—ã–µ –≤—ã–ø–ª–∞—Ç—ã ùëãùëñ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –∑–∞–∫–æ–Ω—É
  U1[i] = U1[i - 1] + c1*œÑ1[i] - X
  i = i + 1
}
U1
T1
plot(T1, U1, type = 'l', main = "–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (12) –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏—è:")

# –±) –£—Å–ª–æ–≤–∏–µ: ùúå = (ùëê/ùúÜùúá) ‚àí 1 > 0 –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö:
c2 = 1
Œª2 = 0.8
Œº2 = 10
œÅ2 = c2/(Œª2*Œº2) - 1; œÅ2 # < 0

i = 2
U2[1] = U_0
T2 = 0
œÑ2[1] = rexp(1, Œª2)
T2[1] = œÑ2[1]
while (T2[i - 1] < t_max)
{
  œÑ2[i] = rexp(1, Œª2)
  T2[i] = T2[i - 1] + œÑ2[i] # —Ä–µ–∞–ª–∏–∑—É–µ–º —Å.–≤. ùúèi, –∫–æ—Ç–æ—Ä–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–µ–ª–∏—á–∏–Ω–∞ ùëái = ùúèi 
  # –∏ –≤ –º–æ–º–µ–Ω—Ç ùëái —Ä–µ–∞–ª–∏–∑—É–µ–º —Å.–≤. ùëãi –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–µ–ª–∏—á–∏–Ω—É ùëàùëái
  
  X = rexp(1, 1/Œº2) # —Å—Ç—Ä–∞—Ö–æ–≤—ã–µ –≤—ã–ø–ª–∞—Ç—ã ùëãùëñ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –∑–∞–∫–æ–Ω—É
  U2[i] = U2[i - 1] + c2*œÑ2[i] - X
  i = i + 1
}
U2
T2
plot(T2, U2, type = 'l', main = "–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (12) –ø—Ä–∏ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏—è:")

# 4. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—ã–±–æ—Ä–æ—á–Ω—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è —Ñ–∏—Ä–º—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö 
# –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: tmax = 1000, c = 1, ùúÜ = 0.3, ùúá = 3, U0 = 100, –ø–æ —Ñ–æ—Ä–º—É–ª–µ
# ùúìÀÜ= 1/ùëÅ ‚àëÔ∏Åùúí(Ai), –≥–¥–µ ùëÅ = 1000 ‚Äì –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –ø—Ä–æ—Ü–µ—Å—Å–∞ (12),
#  ùúí(Ai) ‚Äì –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏—è (14) (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–∑–æ—Ä–µ–Ω–∏—è) –¥–ª—è ùëñ-–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. 
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–∏–º–æ—Å—Ç—å —É—Å–ª–æ–≤–∏—è (16) —Å –∑–∞–º–µ–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã ùúì(ùë¢) –Ω–∞ ùúìÀÜ.

t_max = 1000
c3 = 1
Œª3 = 0.3
Œº3 = 3
U_0 = 100
N = 1000 
sum_xa = j = 0
U = œÑ = 0
for(i in 1 : N) 
{
  U = œÑ = 0
  i = 2
  j = 0
  U[1] = U_0
  œÑ[1] = rexp(1, Œª3)
  T = 0
  T[1] = œÑ[1]
  while (T[i - 1] < t_max)
  {
    œÑ[i] = rexp(1, Œª3)
    T[i] = T[i - 1] + œÑ[i] # —Ä–µ–∞–ª–∏–∑—É–µ–º —Å.–≤. ùúèi, –∫–æ—Ç–æ—Ä–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–µ–ª–∏—á–∏–Ω–∞ ùëái = ùúèi 
    # –∏ –≤ –º–æ–º–µ–Ω—Ç ùëái —Ä–µ–∞–ª–∏–∑—É–µ–º —Å.–≤. ùëãi –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–µ–ª–∏—á–∏–Ω—É ùëàùëái
    X = rexp(1, 1/Œº3) # —Å—Ç—Ä–∞—Ö–æ–≤—ã–µ –≤—ã–ø–ª–∞—Ç—ã ùëãùëñ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –∑–∞–∫–æ–Ω—É
    U[i] = U[i - 1] + c3*œÑ[i] - X
    if (U[i] < 0) # –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ {Ut} –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è 
      # –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è UTi < 0
    { j = 1 }
    
    i = i + 1
  }
  sum_xa = sum_xa + j # –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ–±—ã—Ç–∏—è (14) (–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–∑–æ—Ä–µ–Ω–∏—è) –¥–ª—è ùëñ-–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
}
sum_xa
Œ®1 = (1/N)*sum_xa # –≤—ã–±–æ—Ä–æ—á–Ω–∞—è –≤–µ—Ä-—Ç—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è —Ñ–∏—Ä–º—ã –ø—Ä–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–∏–º–æ—Å—Ç–∏ —É—Å–ª–æ–≤–∏—è (16) —Å –∑–∞–º–µ–Ω–æ–π –≤–µ–ª–∏—á–∏–Ω—ã ùúì(ùë¢) –Ω–∞ ùúìÀÜ:
œÅ = c3/(Œª3*Œº3) - 1
Œ®2 = exp(-œÅ*U_0/(Œº3*(1 + œÅ)))
Œ®1; Œ®2 # –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ª–æ–≤–∏–µ: Œ®1 <= Œ®2
